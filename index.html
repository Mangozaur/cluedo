<!doctype html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title></title>

    <link rel="stylesheet" href="vendor/bs46/css/bootstrap.min.css">
    <script src="vendor/jquery-3.0.0.slim.min.js"></script>
    <script src="vendor/bs46/js/bootstrap.bundle.min.js"></script>

    <style>
        #game table.table {
            width: auto;
        }
        #name-length {
            position: absolute;
            left: -9999px;
        }
        #game {
            display: flex;
            flex-flow: wrap;
        }
        #game table {
            table-layout : fixed;
            border-collapse: collapse;
            margin: 1rem;
        }
        #game table td,
        #game table th {
            border: 1px solid #ccc;
            padding: 1px 5px;
            text-align: center;
            vertical-align: middle;
        }
        #game table th {
            vertical-align: bottom;
        }
        #game table th.item {
            cursor: pointer;
            text-align: left;
        }
        #game table th.strike {
            text-decoration: line-through;
        }

        #game table td {
            min-width: 2rem;
            font-weight: bold;
        }
        #game table td span.yes {
            color: blue;
        }
        #game table td span.no {
            color: crimson;
            font-size: 150%;
            line-height: 0;
        }
        #game table td span.q {
            color: gray;
        }

        #game table th.name {
            text-align: center;
        }

        .vertical-name #game table th.name {
            position: relative;
        }
        .vertical-name #game table th.name span {
            position: absolute;
            display:block;
            white-space:nowrap;
            text-align: left;
            transform: rotate(-90deg);
            transform-origin: left;
            margin-left: 9px;
            margin-top: -40%;
            /*margin-top: -1rem;*/
        }

        @media (min-width: 768px) {
            #name-length {
                font-size: 200%;
            }
            #game table {
                table-layout : auto;
                border-collapse: collapse;
                margin: 1rem;
            }
            #game table.table {
                width: 100%;
                font-size: 200%;
            }
            #game table td {
                width: 6rem;
                height: 5rem;
            }
            #game table.table th.item {
                vertical-align: middle;
            }
        }


    </style>
</head>
<body class="vertical-name">
<style id="style"></style>
<div id="name-length"></div>

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <br>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <button class="btn btn-lg float-right btn-outline-dark" id="btn-settings">üõ†</button>
            <h1>Cluedo</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-12" id="game">

        </div>
    </div>

</div>

<!--[ MODAL START ]-->
<div class="modal" tabindex="-1" id="settings-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#players">–ò–≥—Ä–æ–∫–∏</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#chars">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#rooms">–ö–æ–º–Ω–∞—Ç—ã</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#weapons">–û—Ä—É–∂–∏–µ</a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="players" role="tabpanel">
                        <label>
                            <input type="checkbox" checked id="vertical-names"> –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
                        </label>
                        <table class="table table-borderless table-sm" id="table-players">
                            <tr><td><input value="–Ø" class="disabled" disabled></td></tr>
                            <tr><td><input value="–ò–≥—Ä–æ–∫ 1" ><button class="btn btn-sm btn-outline-danger float-right btn-remove">&times;</button></td></tr>
                            <tr><td><input value="–ò–≥—Ä–æ–∫ 2"><button class="btn btn-sm btn-outline-danger float-right btn-remove">&times;</button></td></tr>
                            <tr><td><input value="–ò–≥—Ä–æ–∫ 3"><button class="btn btn-sm btn-outline-danger float-right btn-remove">&times;</button></td></tr>
                            <tr><td><input value="–ò–≥—Ä–æ–∫ 4"><button class="btn btn-sm btn-outline-danger float-right btn-remove">&times;</button></td></tr>
                            <tr><td><button class="btn btn-info" id="btn-add-player">–ï—â–µ –∏–≥—Ä–æ–∫</button></tr>
                        </table>
                    </div>

                    <div class="tab-pane" id="chars" role="tabpanel">
                        <table class="table table-borderless table-sm">
                            <tr><td><input value="–ì–æ—Ä—á–∏—á–Ω–∏–∫–æ–≤" required></td></tr>
                            <tr><td><input value="–ö—Ä–∞—Å–Ω–æ–≤–∞" required></td></tr>
                            <tr><td><input value="–ë–µ–ª—ã—Ö" required></td></tr>
                            <tr><td><input value="–ó–µ–ª–µ–Ω–æ–≤–∏—á" required></td></tr>
                            <tr><td><input value="–ì–æ–ª—É–±–µ–≤–∞" required></td></tr>
                            <tr><td><input value="–ß–µ—Ä–Ω–∏—á–µ–Ω–∫–æ" required></td></tr>
                        </table>
                    </div>

                    <div class="tab-pane" id="rooms" role="tabpanel">
                        <table class="table table-borderless table-sm">
                            <tr><td><input value="–í–∞–Ω–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞" required></td></tr>
                            <tr><td><input value="–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–∞–ª" required></td></tr>
                            <tr><td><input value="–ì–æ—Å—Ç–∏–Ω–∞—è" required></td></tr>
                            <tr><td><input value="–û–±—Å–µ—Ä–≤–∞—Ç–æ—Ä–∏—è" required></td></tr>
                            <tr><td><input value="–ü—Ä–∏—Ö–æ–∂–∞—è" required></td></tr>
                            <tr><td><input value="–î–æ–º –¥–ª—è –≥–æ—Å—Ç–µ–π" required></td></tr>
                            <tr><td><input value="–°—Ç–æ–ª–æ–≤–∞—è" required></td></tr>
                            <tr><td><input value="–ö—É—Ö–Ω—è" required></td></tr>
                            <tr><td><input value="–¢–µ—Ä–∞—Å—Å–∞" required></td></tr>
                        </table>
                    </div>

                    <div class="tab-pane" id="weapons" role="tabpanel">
                        <table class="table table-borderless table-sm">
                            <tr><td><input value="–ë–∏—Ç–∞" required></td></tr>
                            <tr><td><input value="–ü–∏—Å—Ç–æ–ª–µ—Ç" required></td></tr>
                            <tr><td><input value="–ö–∞–Ω–¥–µ–ª—è–±—Ä" required></td></tr>
                            <tr><td><input value="–ù–æ–∂" required></td></tr>
                            <tr><td><input value="–¢—Ä–æ—Ñ–µ–π" required></td></tr>
                            <tr><td><input value="–¢–æ–ø–æ—Ä" required></td></tr>
                            <tr><td><input value="–ì–∞–Ω—Ç–µ–ª—è" required></td></tr>
                            <tr><td><input value="–Ø–¥" required></td></tr>
                            <tr><td><input value="–í–µ—Ä–µ–≤–∫–∞" required></td></tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary float-left" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" id="start">–ù–∞—á–∞—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<!--[ MODAL END ]-->

<script>
    $(function () {
        $('#btn-settings').on('click', function() {
            $('#settings-modal').modal({
                backdrop: 'static',
            });
        });

        // –¥–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞
        $('#btn-add-player').on('click', function(e) {
            var $btn = $(e.currentTarget);
            var $tr = $btn.closest('tr');
            $tr.before('<tr><td><input value=""><button class="btn btn-sm btn-outline-danger float-right btn-remove">&times;</button></td></tr>');
        });

        // —É–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞
        $('#table-players').on('click', '.btn-remove', function () {
            $(this).closest('tr').remove();
        })

        $('#vertical-names').on('click', function () {
            $('body').toggleClass('vertical-name');
        });

        // –ó–∞—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –ø—É–Ω–∫—Ç–æ–≤
        $('#game').on('click', 'th.item', function(){
            $(this).toggleClass('strike');
        });

        // –∫–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–µ
        $('#game').on('click', 'td', function() {
            var $td = $(this);
            switch ($td.data('state')) {
                case 'yes':
                    $td.html('<span class="q">?</span>').data('state', 'q');
                    break;

                case 'no':
                    $td.html('<span class="yes">V</span>').data('state', 'yes');
                    break;

                case 'q':
                    $td.html('').data('state', '');
                    break;

                default:
                    $td.html('<span class="no">&times;</span>').data('state', 'no');
            }
        });

        $('#start').on('click', function() {
            startGame();
            $('#settings-modal').modal('hide');
        });

        startGame();
    });

    function startGame() {
        // name len
        var name_len = 0;
        var $measure = $('#name-length');
        $('#table-players').find('input').each(function(){
            var $inp = $(this);
            $measure.text($inp.val());
            name_len = Math.max(name_len, $measure.width());
        });
        // name_len += 20; // paddings
        name_len += $measure.height();
        $('#style').html('.vertical-name #game table th.name {height: ' + name_len + 'px;}');

        var html = '';
        var chars = [];
        $('#chars').find('input').each(function () {
            chars.push($(this).val());
        });
        html += makeTable(chars);

        var weapons = [];
        $('#weapons').find('input').each(function () {
            weapons.push($(this).val());
        });
        html += makeTable(weapons);

        var rooms = [];
        $('#rooms').find('input').each(function () {
            rooms.push($(this).val());
        });
        html += makeTable(rooms);


        $('#game').html(html);
    }

    function makeTable(values)
    {
        var table = '<table class="table"><thead><tr><th scope="col"></th><th scope="col">–Ø</th>';
        var c = 1;
        $('#table-players').find('input[class!=disabled]').each(function(){
            c++;
            var $inp = $(this);
            table += '<th scope="col" class="name"><span>' + $inp.val() + '</span></th>';
        });

        table += '</tr></thead><tbody>\n';

        values.forEach(function (v) {
            table += '<tr><th scope="row" class="item">' + v + '</th>';
            for (var i = 0; i < c; i++) {
                table += '<td></td>';
            }
            table += '</tr>';
        });

        table += '</tbody></table>';

        return table;
    }
</script>
</body>
</html>